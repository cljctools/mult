#!/bin/bash

clean(){
    rm -rf resources/out out
}

purge(){
    clean
    rm -rf  .shadow-cljs .cpcache 
}

shadow(){
    ./node_modules/.bin/shadow-cljs "$@"
}

server(){
    shadow -A:core:dev server
    # yarn server
}

dev(){
    npm i
    shadow -A:core:dev watch :extension :gui #:extension-bootstrap  
    # shadow -A:core:dev watch :extension :bootstrap 
}

tree(){
    clojure -A:core:dev:optimized -Stree
}

compile(){
    npm i
    shadow -A:core:dev compile :mult-extension :mult-bootstrap :mult-tabapp
}

dock() {

    NAME=mult.extension

    # WORKDIR_PATH=$VOLUME_PATH/deathstar/build/worker
    VOLUME_PATH1=/ctx/code
    WORKDIR_PATH=$VOLUME_PATH1/mult/build/extension

    docker build \
    --build-arg WORKDIR_PATH=$WORKDIR_PATH \
    -t $NAME \
    -f dev.Dockerfile .

    docker run  --rm \
                --cpus=4.0 \
                --memory=4g \
                --name $NAME \
                -it \
                -p 5100:5100 \
                -p 5101:5101 \
                -p 5102:5102 \
                -v "$(cd ../../../ && pwd)":$VOLUME_PATH1 \
                -v "$(pwd)/.user":/root \
                 $NAME \
                 bash
}


cljs_compile(){
    clj -A:core:dev -m cljs.main -co build.edn -c mult.extension
}

fwm(){
    clojure -A:core:dev \
    -m nrepl.cmdline  \
    --middleware "[cider.nrepl/cider-middleware cider.piggieback/wrap-cljs-repl]" \
    --bind "0.0.0.0" --port 5100
}

"$@"